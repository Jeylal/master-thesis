# Conclusion

The aim of this study was to explore the social foundations of the transformation of Swiss capitalism since the 1980s. The rationale was to show that the neoliberal transformation of the Swiss hybrid model had to be founded on a strategy of institutional change supported by a sufficiently broad social base.

The crisis of the 90s did not mark a break-up of the Swiss dominant social bloc, but a recomposition and a change in the power balance within the bloc itself. While the crisis did not destabilized the left bloc that much, the right bloc, that I named "Liberal-Conservative" throughout this work, underwent important process of change.

In fact, the social bases of the political parties representing the Liberal-Conservative bloc, the PRD-PLR, PDC and UDC, changed substantially since the 80s. Unlike @durrer_de_la_sota_party_2021, who showed that the social base of right-wing government parties stayed rather stable since the 70s, the results presented in the previous section show that, while the UDC's social basis was rather merchant in the 80s, it transformed into a popular basis during the 90s. Furthermore, the social basis of the PRD (then PLR) used to be very bourgeois until the 2010s, period after which this social base showed trends towards an evolution into a merchant right. Interestingly, my results are more supportive of the brahmin left vs merchant right divide hypothesis than the WPID's own results for the Swiss case. However, if one looks at political leaning instead of party support, the left appears to be bourgeois in the sense that it is supported by the upper-middle income groups and by university graduates, while right self-identification evolved into a merchant right pattern.

Then, an analysis closer to the methods and conceptual framework of the neorealist approach was carried out through a latent class analysis for the late 1990s in order to assess more closely the recomposition of the left and liberal-conservative blocs during the crisis. The LCA results show that the bourgeois basis that, mediated by the PRD, could support a neoliberal and pro-EU strategy was rather narrow (around 5% only). In fact, a strategy aggregating social groups which were opponents of EU integration, conservative vis-à-vis immigration and cultural issues would gather a broader base. This strategy was endorsed by the UDC, which then became the first Swiss party in the 2003 federal elections.

As stated in the introduction, the present work is a first attempt to employ neorealist framework and methodology to study institutional change in Switzerland. The present work suffers from several limitations that could be improve in further work First, the time span ranges from 1981 to 2016. Although the time frame can't really go back further than 1981, it could be extended to most recent years. This could be done, for instance, by analyzing the *VOTO* studies (the successor of the *VOX* studies since 2017) which collected post-voting survey data from 2017 to 2020. This analysis of the *VOTO* studies could be complemented, as done in this work, by a latent class analysis using more recent data, for instance the SELECTS 2019 panel study, which offers even better questions than the SELECTS post-election data for 1999 used in the previous section. Overall, more recent data analysis would be a good complement to the present study.

Finally, the present work tends to overlook the crucial role of ideology and political strategies. On the one hand, the different political strategies aimed at promoting a new Swiss socio-economic model, both on the left and the right, deserve to be more carefully explored. On the other hand, ideology, both at the Swiss and international levels, could explain the transformations of these strategies, but also the transformation of the social basis of the different blocs.

# Appendix

```{r set up}
#| echo: false
#| warning: false
#| message: false
library(flextable)
library(huxtable)
library(irr)
library(JuliaCall)
library(JuliaConnectoR)
library(tidyverse)
library(haven)
library(quarto)
library(sjlabelled)
library(readr)
library(readxl)
library(haven)
library(viridis)
library(stargazer)
library(gtsummary)
library(gt)
library(brms)
library(ggrepel)
library(cowplot)
library(ggpubr)
library(lme4)
library(prediction)
library(marginaleffects)
library(ggeffects)
library(ordinal)
library(broom)
library(knitr)
library(readr)
library(gtExtras)
library(broom.mixed)
library(GGally)
library(questionr)
library(car)
library(effects)
library(sjPlot)
library(margins)
library(cAIC4)
library(ordinal)
library(pacman)
```

```{r import voxit}
#| echo: false
#| message: false
#| warning: false

vox <- read_sav("data/voxit.sav")
```

```{r create income and educ variable}
#| warning: false
#| message: false
#| echo: false

# Two ways to create the income variable
vox <- vox %>% 
  mutate(income = if_else(revenu == 1 & is.na(nivmena), 4,
                          if_else(revenu == 2 & is.na(nivmena), 3,
                                  if_else(revenu %in% c(3,4) & is.na(nivmena), 2,
                                          if_else(revenu == 5 & is.na(nivmena), 1,
                                                  if_else(is.na(revenu) & annee <= 1993, nivmena, NA))))))

         
vox$income <- ifelse(vox$income == 4, -1,
                    ifelse(vox$income == 3, 0,
                        ifelse(vox$income == 2, 1,
                          ifelse(vox$income == 1, 2, NA)))) # centering around zero, this will make the intercept more interpretable 


# for education, rescale the values so that the lowest level is equal to zero
vox <- vox %>% 
  mutate(education = case_when(
    educ == 1 ~ 0,
    educ == 2 ~ 1,
    educ == 3 ~ 2,
    educ == 4 ~ 3,
    educ == 5 ~ 4,
    educ == 6 ~ 5,
    is.na(educ) ~ NA
  ),
  educationf = case_when(
    educ == 1 ~ "comp_school",
    educ == 2 ~ "voc_training",
    educ == 3 ~ "maturity",
    educ == 4 ~ "higher_voctraining",
    educ %in% c(5,6) ~ "University",
    is.na(educ) ~ NA
  ),
  educationLevel = case_when(
    educationf == "comp_school" ~ "primary",
    educationf %in% c("voc_training", "maturity") ~ "secondary",
    educationf %in% c("higher_voctraining", "University") ~ "tertiary"
  ),
  
  incomef = case_when(
    income == -1 ~ "low",
    income == 0 ~ "middle_low",
    income == 1 ~ "middle_high",
    income == 2 ~ "high"
  ))

vox$educationf <- relevel(factor(vox$educationf), ref = "voc_training")
vox$educationLevel <- relevel(factor(vox$educationLevel), ref = "primary")
vox$incomef <- relevel(factor(vox$incomef), ref = "low")
```

```{r party dummies and other recoding}
#| warning: false
#| message: false
#| echo: false
vox$pss <- ifelse(vox$p02 == 12, 1,
                  ifelse(is.na(vox$p02), NA, 0))

vox$udc <- ifelse(vox$p02 == 13, 1,
                  ifelse(is.na(vox$p02), NA, 0))

vox$plr <- ifelse(vox$p02 == 20, 1, ### le parti radical democratique fusionne avec le parti liberal en 2009
                  ifelse(vox$p02 == 4, 1,
                  ifelse(is.na(vox$p02), NA, 0)))

vox$green <- ifelse(vox$p02 == 6, 1,
                  ifelse(is.na(vox$p02), NA, 0))

vox$pdc_pcs <- if_else(vox$p02 %in% c(0, 1, 2), 1,
                       if_else(is.na(vox$p02), NA, 0))

vox$no_party <- if_else(vox$p02 %in% c(33), 1,
                       if_else(is.na(vox$p02), 1, 0))

vox$libgreens <- if_else(vox$p02 %in% c(19), 1,
                       if_else(is.na(vox$p02), NA, 0))

vox$gender <- factor(vox$sexe, levels = c(1, 2), labels = c("male", "female"))
vox$married <- ifelse(vox$etatciv == 2, 1,
                      ifelse(is.na(vox$etatciv), NA, 0))

vox$regionL <- as_character(vox$regiling)
vox$religion <- relevel(factor(as_character(vox$confess)), ref = "Catholique romain")

## recoding age in 4 categories

vox$age_cat <- cut(vox$age, c(13, 30, 45, 65, 99), right = FALSE, include.lowest = TRUE)

vox$annee_cat <- cut(vox$annee, seq(from = 1981, to = 2016, by = 5), right = TRUE, include.lowest = TRUE)
vox$annee_f <- factor(vox$annee)

vox$canton <- as_character(vox$canton)


vox$house_ownership <- if_else(vox$statloge == 1, 1, 0)

### classes sociales dummies selon le secteur du répondant (posprof) ou du chef du menage (s31) sauf pour public
vox <- 
  vox %>% 
  mutate(
    farmer = if_else(posprof == 1 | s31 == 4, 1, 0), 
    self_employed = if_else(posprof == 2 | s31 == 1, 1, 0),
    ouvrier = if_else(posprof == 7 | s31 == 5, 1, 0),
    public = if_else(posprof == 6, 1, 0),
    atheist = if_else(confess == 4, 1, 0),
    protestant = if_else(confess == 1, 1, 0),
    catholic = if_else(confess %in% c(2, 5), 1, 0),
    lr = as.ordered(p04),
    
    left = if_else(p04 %in% c(0,1,2,3,4), 1,
                   if_else(is.na(p04), NA, 0)),
    center = if_else(p04 %in% c(5), 1,
                   if_else(is.na(p04), NA, 0)),
    right = if_else(p04 %in% c(6,7,8,9,10), 1,
                   if_else(is.na(p04), NA, 0)),
    stateint = if_else(val11 %in% c(1,2,3), 1,
                       if_else(is.na(val11), NA, 0)),
    redistribution = if_else(val5 %in% c(5,6,7), 1,
                       if_else(is.na(val5), NA, 0)),
    equal_rights_chforeign = if_else(val9 %in% c(1,2,3), 1,
                       if_else(is.na(val9), NA, 0))
    
  )


vox1 <- 
  vox %>% 
  filter(annee <= 1992) %>% 
  mutate(
    nivmenaf = factor(as_character(nivmena)),
    annee_cat = case_when(
      annee %in% c(1981:1985) ~ "[1981,1985]",
      annee %in% c(1986:1989) ~ "[1986,1989]",
      annee %in% c(1990:1992) ~ "[1990,1992]"
    )
  )

vox2 <- 
  vox %>% 
  filter(annee >= 1992) %>% 
  mutate(
    revenuf = factor(as_character(revenu)),
    income = case_when(
      revenu == 1 ~ "less_3k",
      revenu == 2 ~ "[3k,5k]",
      revenu == 3 ~ "[5k,7k]",
      revenu == 4 ~ "[7k,9k]",
      revenu == 5 ~ "more_9k"
      
    )
  )


vox2$income <- relevel(factor(vox2$income), ref = "less_3k")

vox2$annee_cat <- cut(vox2$annee, seq(from = 1992, to = 2016, by = 4), right = FALSE, include.lowest = TRUE)

vox <- 
vox %>% 
  mutate(
    party_id = case_when(
    p02 %in% c(0, 1, 2) ~ "pdc_pcs",
    p02 %in% c(4, 9, 20) ~ "plr",
    p02 %in% c(12) ~ "ps",
    p02 %in% c(13) ~ "udc",
    p02 %in% c(6) ~ "greens",
    p02 %in% c(3,5,7,8,10,11,14,15,16,17,18,19) ~ "other party",
    p02 %in% c(31,32) ~ "multiple parties or not a party, but a person",
    p02 %in% c(33) ~ "no party"
  ))

```

```{r}
#| warning: false
#| message: false
#| echo: false

reg_ps <- glm(data = vox, pss ~incomef*educationf + incomef:annee_cat + educationf:annee_cat + annee_cat + gender + age_cat + religion + regionL + married + house_ownership, family = binomial(link = "logit"))

reg_plr <- glm(data = vox, plr ~incomef*educationf+ incomef:annee_cat + educationf:annee_cat + annee_cat + gender + age_cat + religion + regionL+ married + house_ownership, family = binomial(link = "logit"))

reg_pdc <- glm(data = vox, pdc_pcs ~incomef*educationf +  incomef:annee_cat + educationf:annee_cat + annee_cat + gender + age_cat + religion + regionL + married + house_ownership, family = binomial(link = "logit"))

reg_udc <- glm(data = vox, udc ~incomef*educationf +  incomef:annee_cat + educationf:annee_cat + annee_cat + gender + age_cat + religion + regionL+ married + house_ownership, family = binomial(link = "logit"))

reg_greens <- glm(data = vox, green ~incomef*educationf +  incomef:annee_cat + educationf:annee_cat + annee_cat + gender + age_cat + religion + regionL+ married + house_ownership, family = binomial(link = "logit"))

reg_abstention <- glm(data = vox, no_party ~ incomef*educationf + incomef:annee_cat + educationf:annee_cat + annee_cat + gender + age_cat + religion + regionL+ married + house_ownership, family = binomial(link = "logit"))

###### political leaning regression


reg_left <- glm(data = vox2, 
                left ~ income*educationf + income:annee_cat + educationf:annee_cat + annee_cat + gender + age_cat + religion + regionL+ married + house_ownership, family = binomial(link = "logit"))

reg_center <- glm(data = vox2, 
                center ~ income*educationf + income:annee_cat + educationf:annee_cat + annee_cat + gender + age_cat + religion + regionL+ married + house_ownership, family = binomial(link = "logit"))

reg_right <- glm(data = vox2, 
                right ~ income*educationf + income:annee_cat + educationf:annee_cat + annee_cat + gender + age_cat + religion + regionL+ married + house_ownership, family = binomial(link = "logit"))

#########3 issue position regression
reg_state <- glm(data = vox2, 
                stateint ~ income*educationf + income:annee_cat + educationf:annee_cat + annee_cat + gender + age_cat + religion + regionL+ married + house_ownership, family = binomial(link = "logit"))

reg_redistr <- glm(data = vox2, 
                redistribution ~ income*educationf + income:annee_cat + educationf:annee_cat + annee_cat + gender + age_cat + religion + regionL + married + house_ownership, family = binomial(link = "logit"))

reg_equal_rights_chforeign <- glm(data = vox2, 
               equal_rights_chforeign  ~ income*educationf + income:annee_cat + educationf:annee_cat + annee_cat + gender + age_cat + religion + regionL + married + house_ownership, family = binomial(link = "logit"))


vox_regression_ps <- readRDS("C:/Users/celal/OneDrive/Bureau/master-thesis/data/regression_results/vox_regression_ps.rds")
vox_regression_plr <- readRDS("C:/Users/celal/OneDrive/Bureau/master-thesis/data/regression_results/vox_regression_plr.rds")
vox_regression_udc <- readRDS("C:/Users/celal/OneDrive/Bureau/master-thesis/data/regression_results/vox_regression_udc.rds")
vox_regression_pdc <- readRDS("C:/Users/celal/OneDrive/Bureau/master-thesis/data/regression_results/vox_regression_pdc.rds")
vox_regression_greens <- readRDS("C:/Users/celal/OneDrive/Bureau/master-thesis/data/regression_results/vox_regression_greens.rds")
vox_regression_noparty <- readRDS("C:/Users/celal/OneDrive/Bureau/master-thesis/data/regression_results/vox_regression_noparty.rds")

glmer_ame_issue <- readRDS("C:/Users/celal/OneDrive/Bureau/master-thesis/data/ame/glmer_ame_issue.rds")

glmer_ame_leaning <- readRDS("C:/Users/celal/OneDrive/Bureau/master-thesis/data/ame/glmer_ame_leaning.rds")

glmer_ame_party <- readRDS("C:/Users/celal/OneDrive/Bureau/master-thesis/data/ame/glmer_ame_party.rds")

vox_regression_glmer_eqchances <- readRDS("C:/Users/celal/OneDrive/Bureau/master-thesis/data/regression_results/vox_regression_glmer_eqchances.rds")

vox_regression_glmer_redistribution <- readRDS("C:/Users/celal/OneDrive/Bureau/master-thesis/data/regression_results/vox_regression_glmer_redistribution.rds")

vox_regression_glmer_stateint <- readRDS("C:/Users/celal/OneDrive/Bureau/master-thesis/data/regression_results/vox_regression_glmer_stateint.rds")

```

```{r dep variables descriptive statistics}
#| echo: false
#| warning: false
#| message: false

descreg_ps <- lm(data = vox, pss ~ annee_f-1)
descreg_udc <- lm(data = vox, udc ~ annee_f-1)
descreg_plr <- lm(data = vox, plr ~ annee_f-1)
descreg_noparty <- lm(data = vox, no_party ~ annee_f-1)
descreg_pdc <- lm(data = vox, pdc_pcs ~ annee_f-1)
descreg_greens <- lm(data = vox, green ~ annee_f-1)

descreg_state <- lm(data = vox, stateint ~ annee_f-1)
descreg_left <- lm(data = vox, left ~ annee_f-1)
descreg_noleaning <- lm(data = vox, center ~ annee_f-1)
descreg_right <- lm(data = vox, right ~ annee_f-1)
descreg_eqright <- lm(data = vox, equal_rights_chforeign ~ annee_f-1)
descreg_stateint <- lm(data = vox, stateint ~ annee_f-1)
descreg_redistribution <- lm(data = vox, redistribution ~ annee_f-1)

```

```{r plot descriptive parties}
#| echo: false
#| warning: false
#| message: false
#| label: fig-plotdescrparties
#| fig-cap: "Party identification"
#| fig-width: 8

vox %>% 
  group_by(annee_cat) %>% 
  count(party_id) %>% 
  drop_na() %>% 
  mutate(prop = round(n/sum(n), digits = 3)) %>% 
  ungroup() %>% 
  ggplot()+
  aes(x = annee_cat, y = prop, fill = party_id, label = scales::percent(prop))+
  geom_col()+
  theme_minimal()+
  scale_y_continuous(labels = scales::percent)+
  scale_fill_manual(values = c("chartreuse", "darkgrey", "grey", "salmon", "darkgoldenrod1","darkblue", "darkred", "darkgreen"))+
  geom_text(position = position_stack(vjust = 0.5), 
            hjust = 0.5, size = 2.5, color = "white")+
  theme(legend.position="bottom", legend.box="vertical", legend.margin=margin(), legend.title = element_blank())+
  guides(color=guide_legend(nrow=3))+
  labs(x = "", y = "", caption = "Data source: VoxIt")


  

```

```{r plot descriptive leaning}
#| echo: false
#| warning: false
#| message: false
#| label: fig-plotdescrleaning
#| fig-cap: "Proportions of Swiss citizen leaning for the left, the right or neither left or right: 1988-2016"

plot_models(descreg_left, descreg_noleaning, descreg_right, legend.title = "")+theme_bw()+coord_cartesian()+scale_x_discrete(limits = rev, labels = 1988:2016)+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = c(0.85,0.8), legend.background = element_blank())+ylim(0.2, 0.55)+labs(y = "", caption = "Data source: VoxIt")+scale_color_discrete(labels = c("left", "don't know", "right"))

```

```{r plot descriptive issue position}
#| echo: false
#| warning: false
#| message: false
#| label: fig-plotdescrIP
#| fig-cap: "Proportions of Swiss citizen supporting state intervention, equal rights & chances for foreigners, and redistribution: 1993-2016"
#| fig-width: 8


plot_models(descreg_eqright, descreg_stateint, descreg_redistribution, legend.title = "")+theme_bw()+coord_cartesian()+scale_x_discrete(limits = rev, labels = 1993:2016)+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = c(0.70,0.15), legend.background = element_blank())+ylim(0.1, 0.7)+labs(y = "", caption = "Data source: VoxIt")+guides(color=guide_legend(nrow=3))+scale_color_discrete(labels = c("In favor of income redistribution", "For state intervention", "For equal rights between foreigners & Swiss citizen"))+ scale_y_continuous(labels = scales::percent)+geom_hline(yintercept = 0.5)

```

```{r table parties left}
#| warning: false
#| message: false
#| echo: false
#| tbl-cap: "Binary logit regressions: party support (log-odds). Full table available [here](https://jeylal.github.io/socialblocsthesis_appendix/#tbl-summarylogitpartiesleft)"
#| label: tbl-summarylogitpartiesleft

library(modelsummary)
library(knitLatex)
library(kableExtra)


modelsummary(list("PS" = reg_ps, "Greens" = reg_greens, "No party" = reg_abstention), stars = TRUE, coef_omit = 15:80)

```

```{r table parties right}
#| warning: false
#| message: false
#| echo: false
#| tbl-cap: "Binary logit regressions: party support (log-odds). Full table available [here](https://jeylal.github.io/socialblocsthesis_appendix/#tbl-summarylogitpartiesright)"
#| label: tbl-summarylogitpartiesright

modelsummary(list("PRD-PLR" = reg_plr, "PDC/PCS" = reg_pdc, "UDC" = reg_udc), stars = TRUE, coef_omit = 15:80)

```


```{r table leaning}
#| warning: false
#| message: false
#| echo: false
#| tbl-cap: "Binary logit regressions: political leaning (log-odds). Full table available [here](https://jeylal.github.io/socialblocsthesis_appendix/#tbl-summarylogitleaning)"
#| label: tbl-summarylogitleaning

modelsummary(list("Left" = reg_left, "Right" = reg_right, "No leaning" = reg_center), stars = TRUE, coef_omit = 15:80)

```

```{r table issue position}
#| warning: false
#| message: false
#| echo: false
#| tbl-cap: "Binary logit regressions: issue position (log-odds). Full table available [here](https://jeylal.github.io/socialblocsthesis_appendix/#tbl-summarylogitIP)"
#| label: tbl-summarylogitIP
modelsummary(list("Redistribution" = reg_redistr, "Equal R&C CH-foreign" = reg_equal_rights_chforeign, 
       "State intervention" = reg_state), stars = TRUE, coef_omit = 15:80)
```

```{r}
#| message: false
#| echo: false
#| warning: false
#| fig-cap: "Average marginal contrasts results from multilevel probit model: party support"
#| label: fig-glmerameparties
#| fig-height: 7

glmer_ame_party %>% 
  filter(contrast %in% c("mean(high) - mean(low)", "mean(University) - mean(voc_training)")) %>%
  filter(party %in% c("ps", "plr", "udc", "pdc", "greens", "No party")) %>% 
  ggplot()+
  aes(x = as_numeric(annee_f), y = estimate, color = contrast, shape = contrast, group = party)+
  geom_point(position = position_dodge(width = 0.3))+
  geom_pointrange(aes(ymin = conf.low, ymax = conf.high), position = position_dodge(width = 0.3))+
  labs(x = "", y = "", caption = "Data source: VoxIt")+
  theme_bw()+
  scale_y_continuous(labels=scales::percent)+
  geom_hline(yintercept = 0)+
  facet_wrap(~party)+
  theme(legend.position="bottom", legend.box="vertical", legend.margin=margin(),
        axis.text.x = element_text(angle = 50, vjust = 1, hjust=1))+
  guides(color=guide_legend(nrow=3))

```

```{r ame glmer leaning}
#| echo: false
#| message: false
#| warning: false
#| fig-cap: "Average marginal contrasts results from multilevel probit regressions: political leaning"
#| label: fig-glmerameleaning



glmer_ame_leaning %>% 
  filter(contrast %in% c("mean(more_9k) - mean(less_3k)", "mean(University) - mean(voc_training)")) %>%
  filter(leaning %in% c("Right", "Left", "Don't know")) %>% 
  ggplot()+
  aes(x = as_numeric(annee_f), y = estimate, color = contrast, shape = contrast, group = leaning)+
  geom_point(position = position_dodge(width = 0.3))+
  geom_pointrange(aes(ymin = conf.low, ymax = conf.high), position = position_dodge(width = 0.3))+
  labs(x = "", y = "", caption = "Data source: VoxIt")+
  theme_bw()+
  scale_y_continuous(labels=scales::percent)+
  geom_hline(yintercept = 0)+
  facet_wrap(~leaning)+
  theme(legend.position="bottom", legend.box="vertical", legend.margin=margin(),
        axis.text.x = element_text(angle = 50, vjust = 1, hjust=1))+
  guides(color=guide_legend(nrow=3))






```

```{r ame glmer IP}
#| echo: false
#| message: false
#| warning: false
#| fig-cap: "Average marginal contrasts results from multilevel probit regressions: issue position"
#| label: fig-glmerameIP

glmer_ame_issue %>% 
  filter(contrast %in% c("mean(more_9k) - mean(less_3k)", "mean(University) - mean(voc_training)")) %>%
  filter(issue %in% c("Equal chances CH-foreign", "Redistribution", "State intervention")) %>% 
  ggplot()+
  aes(x = as_numeric(annee_f), y = estimate, color = contrast, shape = contrast, group = issue)+
  geom_point(position = position_dodge(width = 0.3))+
  geom_pointrange(aes(ymin = conf.low, ymax = conf.high), position = position_dodge(width = 0.3))+
  labs(x = "", y = "", caption = "Data source: VoxIt")+
  theme_bw()+
  scale_y_continuous(labels=scales::percent)+
  geom_hline(yintercept = 0)+
  facet_wrap(~issue)+
  theme(legend.position="bottom", legend.box="vertical", legend.margin=margin(),
        axis.text.x = element_text(angle = 50, vjust = 1, hjust=1))+
  guides(color=guide_legend(nrow=3))



```

```{r lca model selection}
#| echo: false
#| warning: false
#| message: false
#| label: tbl-modellca
#| tbl-cap: "Model selection: 12 clusters model"

selects1999_lcaresults <- read_excel("C:/Users/celal/OneDrive/Bureau/master-thesis/lca estimations/selects1999_lcaresults.xlsx", 
    skip = 5)


selects1999_lcaresults %>% 
  rename(`L2 bootstrap p` = "Bootstrap p...11",
         `-2LL Diff bootstrap p` = "Bootstrap p...16") %>% 
  dplyr::select(!c(Npar, df, VLMR, `p-value...14`, `p-value...10`, `AIC3(LL)`, `Class.Err.`, LL, `Max. BVR`, Model, `BIC(LL)`, `AIC(LL)`)) %>% 
  gt()
```

```{r lca model indicators}
#| echo: false
#| warning: false
#| message: false
#| label: fig-lcaindicators
#| fig-cap: "Variables chosen as indicators in the Latent class model for 1999: descriptive statistics"
#| fig-width: 11
library(tidytidbits)
library(ggstats)
selects1999_classifLatest_rec <- read_sav("C:/Users/celal/OneDrive/Bureau/master-thesis/data/selects1999_classifLatest_rec.sav")

selects1999_classifLatest_rec %>% 
  dplyr::select(matches("op.*")) %>% 
  dplyr::select(!c("polknow_people", "op_order")) %>% 
  gglikert_stacked(add_labels = TRUE)

```

```{r}
#| echo: false
#| message: false
#| warning: false
#| include: false
selects <- read_sav("data/495_Selects_CumulativeFile_Data_1971-2019_v2.3.0.sav")

selects <- 
  selects %>% 
  mutate(
    prod_workers = if_else(class8 == 4, 1, if_else(is.na(class8), NA, 0)),
    eq_chances = if_else(ip9 %in% c(1, 2), 1, if_else(is.na(ip9), NA, 0)),
    uneq_chances = if_else(ip9 %in% c(4,5), 1, if_else(is.na(ip9), NA, 0)),
    raise_exp = if_else(ip13 %in% c(4,5), 1, if_else(is.na(ip13), NA, 0)),
    taxes_hi = if_else(ip2 %in% c(1, 2), 1, if_else(is.na(ip2), NA, 0))
  )


summary(reg_attitude_prodworkers <- lm(eq_chances ~ factor(year) -1, data = selects))
summary(reg_attitude_prodworkers <- lm(eq_chances ~ factor(year) -1, data = selects[selects$class8 == 4,]))
summary(reg_attitude <- lm(eq_chances ~ factor(year) -1, data = selects))

summary(reg_taxeshi <- lm(taxes_hi ~ factor(year) -1, data = selects[selects$class8 == 7,]))

plot_model(reg_attitude_prodworkers)


selects %>% 
  filter(class8 == 4) %>% 
  group_by(year) %>% 
  count(ip9) %>% 
  drop_na() %>% 
  mutate(prop = n/sum(n)) %>% 
  ungroup()
```
